<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Garage Pro One — Synchro iPhone + PC</title>
<link href="./assets/style.css" rel="stylesheet"/>
</head>
<body>
<header class="topbar no-print">
<div class="brand">
<div class="logo">G</div>
<div>
<div class="name">Garage Pro One</div>
<div class="muted" style="font-size:12px">Synchro automatique (Firebase)</div>
</div>
</div>
<nav class="nav" id="navAuthed" style="display:none">
<button class="btn btn-ghost" data-go="dashboard">Dashboard</button>
<button class="btn btn-ghost" data-go="clients">Clients</button>
<button class="btn btn-ghost" data-go="repairs">Réparations</button>
<button class="btn btn-ghost" data-go="promotions" data-role="admin">Promotions</button>
<button class="btn btn-ghost" data-go="revenue" data-role="admin">Revenus</button><button class="btn btn-ghost" data-go="settings" data-role="admin">Paramètres</button>
<button class="btn btn-ghost" id="btnLogout">Déconnexion</button>
</nav>
</header>
<main class="container">
<!-- AUTH VIEW -->
<section class="card" id="viewAuth" style="max-width:560px;margin:18px auto; display:none;">
<h1 style="margin-top:0">Connexion</h1>
<p class="muted">Connexion par email/mot de passe. Tes données seront synchronisées automatiquement entre iPhone et PC.</p>
<div class="divider"></div>
<div class="tabs no-print">
<button class="tab active" id="tabLogin">Se connecter</button>
<!-- Création de compte désactivée dans l'app : comptes via Firebase Auth + /users/{uid} créé par admin -->
<button class="tab" id="tabRegister" style="display:none;">Créer compte</button>
</div>
<div class="alert" id="authError" style="display:none; margin-top:12px;"></div>
<div class="note" id="authOk" style="display:none; margin-top:12px;"></div>
<form class="form" id="formLogin" style="margin-top:12px;">
<label>Email</label>
<input name="email" placeholder="ex: toi@gmail.com" required="" type="email"/>
<label>Mot de passe</label>
<input name="password" placeholder="••••••••" required="" type="password"/>
<button class="btn btn-primary" type="submit">Se connecter</button>
<button class="btn btn-ghost" id="btnForgot" type="button">Mot de passe oublié</button>
</form>
<form class="form" id="formRegister" style="margin-top:12px; display:none;">
<label>Email</label>
<input name="email" placeholder="ex: toi@gmail.com" required="" type="email"/>
<label>Mot de passe (min 6)</label>
<input name="password" placeholder="••••••••" required="" type="password"/>
<button class="btn btn-primary" type="submit">Créer le compte</button>
</form>
<div class="divider"></div>
<div class="note">
<strong>Important</strong><br/>
        Tu dois coller ta configuration Firebase dans <code>assets/firebase-config.js</code> (voir README).
      </div>
</section>
<!-- APP VIEW -->
<section id="viewApp" style="display:none">
<h1 id="pageTitle">Dashboard</h1>
<!-- DASHBOARD -->
<section class="grid" id="viewDashboard">
<div class="card" style="grid-column:1/-1">
<div class="row-between">
<h2>Recherche rapide</h2>
<div class="row">
<button class="btn btn-ghost" data-role="admin" id="btnNewClient">+ Nouveau client</button>
<button class="btn btn-primary" data-role="admin" id="btnNewRepair">+ Nouvelle réparation</button>
</div>
</div>
<form class="form form-inline" onsubmit="return false;">
<input id="quickSearch" placeholder="Nom / Téléphone / Plaque / VIN">
<button class="btn btn-primary" id="btnQuickSearch">Rechercher</button>
<button class="btn btn-ghost" id="btnClearSearch">Effacer</button>
</input></form>
<div class="divider"></div>
<div class="muted" id="searchResults">Tape une recherche pour afficher les résultats.</div>
</div>
<div class="card" style="grid-column:1/-1">
<h2>Résumé</h2>
<div class="kpi" id="kpi"></div>
</div>
<div class="card" style="grid-column:1/-1">
<div class="row-between">
<h2>Réparations ouvertes</h2>
<button class="btn btn-ghost" data-go="repairs">Voir tout</button>
</div>
<div class="table-wrap">
<table>
<thead><tr>
<th>Date</th><th>Client</th><th>Véhicule</th><th>Total TTC</th><th></th>
</tr></thead>
<tbody id="openRepairsTbody">
<tr><td class="muted" colspan="5">Chargement…</td></tr>
</tbody>
</table>
</div>
</div>
</section>
<!-- CLIENTS -->
<section class="card" id="viewClients" style="display:none">
<div class="row-between">
<div class="row" style="gap:12px">
<h2 style="margin:0">Clients</h2>
<span class="muted" id="clientsCount"></span>
</div>
<button class="btn btn-primary" data-role="admin" id="btnNewClient2">+ Ajouter</button>
</div>
<div class="divider"></div>
<form class="form form-inline" onsubmit="return false;">
<input id="clientsSearch" placeholder="Rechercher (nom / téléphone / email)">
<button class="btn btn-primary" id="btnClientsSearch">Rechercher</button>
<button class="btn btn-ghost" id="btnClientsClear">Effacer</button>
</input></form>
<div class="divider"></div>
<div class="table-wrap">
<table>
<thead><tr><th>Nom</th><th>Téléphone</th><th>Email</th><th></th></tr></thead>
<tbody id="clientsTbody"></tbody>
</table>
</div>
</section>
<!-- REPAIRS -->
<section class="card" id="viewRepairs" style="display:none">
<div class="row-between">
<div class="row" style="gap:12px">
<h2 style="margin:0">Réparations</h2>
<span class="muted" id="repairsCount"></span>
</div>
<button class="btn btn-primary" data-role="admin" id="btnNewRepair2">+ Nouvelle</button>
</div>
<div class="divider"></div>
<form class="form form-inline" onsubmit="return false;">
<input id="repairsSearch" placeholder="Nom / Téléphone / Plaque">
<select id="repairsStatus">
<option value="">Tous statuts</option>
<option value="OUVERT">Ouvert</option>
<option value="EN_COURS">En cours</option>
<option value="TERMINE">Terminé</option>
</select>
<button class="btn btn-primary" id="btnRepairsFilter">Filtrer</button>
<button class="btn btn-ghost" id="btnRepairsClear">Effacer</button>
</input></form>
<div class="divider"></div>
<div class="table-wrap">
<table>
<thead><tr><th>Date</th><th>Client</th><th>Véhicule</th><th>Statut</th><th>Total TTC</th><th></th></tr></thead>
<tbody id="repairsTbody"></tbody>
</table>
</div>
</section><section class="card" id="viewRevenue" style="display:none">
<div class="row" style="justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap">
<div>
<h2 style="margin:0 0 6px 0">Revenus &amp; factures</h2>
<div class="muted">Filtre par jour, mois ou période personnalisée.</div>
</div>
<div class="row" style="gap:10px;flex-wrap:wrap;align-items:flex-end">
<div>
<div class="muted" style="font-size:12px;margin-bottom:4px">Filtre</div>
<select class="input" id="revPreset" style="min-width:170px">
<option value="today">Aujourd’hui</option>
<option selected="" value="month">Ce mois</option>
<option value="custom">Personnalisé</option>
</select>
</div>
<div>
<div class="muted" style="font-size:12px;margin-bottom:4px">Du</div>
<input class="input" id="revFrom" type="date"/>
</div>
<div>
<div class="muted" style="font-size:12px;margin-bottom:4px">Au</div>
<input class="input" id="revTo" type="date"/>
</div>
<button class="btn" id="btnRevApply">Appliquer</button>
</div>
</div>
<div class="grid" style="grid-template-columns: repeat(3, minmax(0,1fr)); gap:12px; margin-top:14px">
<div class="box">
<div class="muted">Total période</div>
<div class="val" id="revTotal">$0.00</div>
</div>
<div class="box">
<div class="muted">Factures</div>
<div class="val" id="revCount">0</div>
</div>
<div class="box">
<div class="muted">Moyenne / facture</div>
<div class="val" id="revAvg">$0.00</div>
</div>
</div>
<div style="margin-top:14px; overflow:auto">
<table class="table">
<thead>
<tr>
<th># Facture</th>
<th>Date</th>
<th>Client</th>
<th>Véhicule</th>
<th>Paiement</th>
<th style="text-align:right">Total</th>
<th class="no-print"></th>
</tr>
</thead>
<tbody id="revTbody">
<tr><td class="muted" colspan="7">Aucune facture.</td></tr>
</tbody>
</table>
</div>
</section>

<!-- PROMOTIONS -->
<section class="card" id="viewPromotions" style="display:none">
  <div class="row-between" style="align-items:flex-end; gap:12px; flex-wrap:wrap">
    <div>
      <h2 style="margin:0 0 6px 0">Promotions</h2>
      <div class="muted">Créer une promotion et l’envoyer par email à tes clients.</div>
    </div>
  </div>

  <div class="divider"></div>

  <div class="grid" style="grid-template-columns: 1.1fr .9fr; gap:12px">
    <div class="box">
      <h3 style="margin-top:0">Nouvelle promotion</h3>
      <form class="form" id="formPromo">
        <label>Objet (subject)</label>
        <input name="subject" placeholder="Ex: -15% sur la main d’œuvre cette semaine" required />

        <label>Message (email)</label>
        <textarea name="message" rows="7" placeholder="Bonjour {name},\n\nVoici notre promo..." required></textarea>
        <div class="muted" style="font-size:12px">Astuce: tu peux utiliser <code>{name}</code> et <code>{phone}</code>.</div>

        <div class="row" style="gap:10px; flex-wrap:wrap">
          <div style="min-width:190px; flex:1">
            <label>Valable jusqu’au</label>
            <input name="validUntil" type="date" />
          </div>
          <div style="min-width:190px; flex:1">
            <label>Code promo (optionnel)</label>
            <input name="code" placeholder="Ex: GARAGE15" />
          </div>
        </div>

        <button class="btn btn-primary" type="submit">Enregistrer la promotion</button>
        <div class="note" id="promoSaved" style="display:none; margin-top:10px"></div>
      </form>
    </div>

    <div class="box">
      <h3 style="margin-top:0">Envoi</h3>
      <div class="muted">Envoi via Firebase Cloud Functions (voir README). Tu peux aussi faire un test.</div>
      <div class="divider"></div>
      <label class="muted" style="font-size:12px">Email de test (optionnel)</label>
      <input class="input" id="promoTestEmail" type="email" placeholder="ex: toi@gmail.com" />
      <div class="muted" style="font-size:12px; margin-top:8px" id="promoAudienceInfo">Clients avec email: —</div>
      <div class="divider"></div>
      <button class="btn" id="btnPromoSend" disabled>Envoyer la promotion sélectionnée</button>
      <div class="alert" id="promoSendError" style="display:none; margin-top:10px"></div>
      <div class="note" id="promoSendOk" style="display:none; margin-top:10px"></div>
    </div>
  </div>

  <div class="divider"></div>

  <h3 style="margin:0 0 10px 0">Historique</h3>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Objet</th>
          <th>Valide</th>
          <th>Envoyé</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="promosTbody">
        <tr><td class="muted" colspan="5">Chargement…</td></tr>
      </tbody>
    </table>
  </div>
</section>
<!-- SETTINGS -->
<section class="card" id="viewSettings" style="display:none">
<h2>Paramètres</h2>
<p class="muted">TPS/TVQ sont enregistrées dans le cloud (pour ton compte).</p>
<div class="divider"></div>
<form class="form" onsubmit="return false;">
<label>TPS (%)</label>
<input id="setTps" inputmode="decimal" placeholder="5">
<label>TVQ (%)</label>
<input id="setTvq" inputmode="decimal" placeholder="9.975"/>
<div class="row">
<button class="btn btn-primary" id="btnSaveSettings">Enregistrer</button>
</div>
</input></form>
<div class="divider"></div>
<h3>Sauvegarde</h3>
<div class="row">
<button class="btn btn-ghost" id="btnExport">Exporter (JSON)</button>
<label class="btn btn-ghost" for="importFile" style="cursor:pointer">Importer (JSON)</label>
<input accept="application/json" id="importFile" style="display:none" type="file"/>
</div>
<div class="divider"></div>
<h3>Maintenance</h3>
<div class="row">
<button class="btn btn-danger" id="btnResetCloud">Tout supprimer (cloud)</button>
</div>
</section>
</section>
</main>
<footer class="footer no-print">
<small>© <span id="year"></span> Garage Pro One — <span class="muted">Synchro Firebase</span></small>
</footer>
<!-- MODAL -->
<div aria-hidden="true" class="modal-backdrop" id="modalBackdrop" inert="">
<div class="modal">
<div class="card">
<div class="row-between">
<h2 id="modalTitle" style="margin:0">Modal</h2>
<button class="btn btn-ghost btn-small" id="btnModalClose">Fermer</button>
</div>
<div class="divider"></div>
<div id="modalBody"></div>
</div>
</div>
</div>
<script src="./assets/firebase-config.js"></script>
<script src="./assets/app.js" type="module"></script>
</body>
</html>
