<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Garage Pro One — Synchro iPhone + PC</title>
  <link rel="stylesheet" href="./assets/style.css">
</head>
<body>
  <header class="topbar no-print">
    <div class="brand">
      <div class="logo">G</div>
      <div>
        <div class="name">Garage Pro One</div>
        <div class="muted" style="font-size:12px">Synchro automatique (Firebase)</div>
      </div>
    </div>
    <nav class="nav" id="navAuthed" style="display:none">
      <button class="btn btn-ghost" data-go="dashboard">Dashboard</button>
      <button class="btn btn-ghost" data-go="clients">Clients</button>
      <button class="btn btn-ghost" data-go="repairs">Réparations</button>
      <button class="btn btn-ghost" data-go="settings">Paramètres</button>
      <button class="btn btn-ghost" id="btnLogout">Déconnexion</button>
    </nav>
  </header>

  <main class="container">
    <!-- AUTH VIEW -->
    <section id="viewAuth" class="card" style="max-width:560px;margin:18px auto; "">
      <h1 style="margin-top:0">Connexion</h1>
      <p class="muted">Connexion par email/mot de passe. Tes données seront synchronisées automatiquement entre iPhone et PC.</p>
      <div class="divider"></div>

      <div class="tabs no-print">
        <button class="tab active" id="tabLogin">Se connecter</button>
        <button class="tab" id="tabRegister">Créer compte</button>
      </div>

      <div id="authError" class="alert" style="display:none; margin-top:12px;"></div>
      <div id="authOk" class="note" style="display:none; margin-top:12px;"></div>

      <form class="form" id="formLogin" style="margin-top:12px;">
        <label>Email</label>
        <input name="email" type="email" required placeholder="ex: toi@gmail.com">
        <label>Mot de passe</label>
        <input name="password" type="password" required placeholder="••••••••">
        <button class="btn btn-primary" type="submit">Se connecter</button>
        <button class="btn btn-ghost" type="button" id="btnForgot">Mot de passe oublié</button>
      </form>

      <form class="form" id="formRegister" style="margin-top:12px; display:none;">
        <label>Email</label>
        <input name="email" type="email" required placeholder="ex: toi@gmail.com">
        <label>Mot de passe (min 6)</label>
        <input name="password" type="password" required placeholder="••••••••">
        <button class="btn btn-primary" type="submit">Créer le compte</button>
      </form>

      <div class="divider"></div>
      <div class="note">
        <strong>Important</strong><br>
        Tu dois coller ta configuration Firebase dans <code>assets/firebase-config.js</code> (voir README).
      </div>
    </section>

    <!-- APP VIEW -->
    <section id="viewApp" style="display:none">
      <h1 id="pageTitle">Dashboard</h1>

      <!-- DASHBOARD -->
      <section id="viewDashboard" class="grid">
        <div class="card" style="grid-column:1/-1">
          <div class="row-between">
            <h2>Recherche rapide</h2>
            <div class="row">
              <button class="btn btn-ghost" id="btnNewClient">+ Nouveau client</button>
              <button class="btn btn-primary" id="btnNewRepair">+ Nouvelle réparation</button>
            </div>
          </div>
          <form class="form form-inline" onsubmit="return false;">
            <input id="quickSearch" placeholder="Nom / Téléphone / Plaque / VIN" />
            <button class="btn btn-primary" id="btnQuickSearch">Rechercher</button>
            <button class="btn btn-ghost" id="btnClearSearch">Effacer</button>
          </form>
          <div class="divider"></div>
          <div id="searchResults" class="muted">Tape une recherche pour afficher les résultats.</div>
        </div>

        <div class="card" style="grid-column:1/-1">
          <h2>Résumé</h2>
          <div class="kpi" id="kpi"></div>
          <div class="divider"></div>
          <div class="grid" style="grid-template-columns:1fr; gap:12px">
            <div>
              <h3 style="margin:0 0 8px 0">Revenus (6 derniers mois)</h3>
              <div id="monthsStats" class="muted">—</div>
            </div>
            <div>
              <h3 style="margin:0 0 8px 0">Rendez-vous à venir</h3>
              <div id="upcomingAppts" class="muted">—</div>
            </div>
          </div>
        </div>

        <div class="card" style="grid-column:1/-1">
          <div class="row-between">
            <h2>Réparations ouvertes</h2>
            <button class="btn btn-ghost" data-go="repairs">Voir tout</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr>
                <th>Date</th><th>Client</th><th>Véhicule</th><th>Total TTC</th><th></th>
              </tr></thead>
              <tbody id="openRepairsTbody">
                <tr><td colspan="5" class="muted">Chargement…</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- CLIENTS -->
      <section id="viewClients" class="card" style="display:none">
        <div class="row-between">
          <div class="row" style="gap:12px">
            <h2 style="margin:0">Clients</h2>
            <span class="muted" id="clientsCount"></span>
          </div>
          <button class="btn btn-primary" id="btnNewClient2">+ Ajouter</button>
        </div>
        <div class="divider"></div>

        <form class="form form-inline" onsubmit="return false;">
          <input id="clientsSearch" placeholder="Rechercher (nom / téléphone / email)" />
          <button class="btn btn-primary" id="btnClientsSearch">Rechercher</button>
          <button class="btn btn-ghost" id="btnClientsClear">Effacer</button>
        </form>

        <div class="divider"></div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Nom</th><th>Téléphone</th><th>Email</th><th></th></tr></thead>
            <tbody id="clientsTbody"></tbody>
          </table>
        </div>
      </section>

      <!-- REPAIRS -->
      <section id="viewRepairs" class="card" style="display:none">
        <div class="row-between">
          <div class="row" style="gap:12px">
            <h2 style="margin:0">Réparations</h2>
            <span class="muted" id="repairsCount"></span>
          </div>
          <button class="btn btn-primary" id="btnNewRepair2">+ Nouvelle</button>
        </div>
        <div class="divider"></div>

        <form class="form form-inline" onsubmit="return false;">
          <input id="repairsSearch" placeholder="Nom / Téléphone / Plaque" />
          <select id="repairsStatus">
            <option value="">Tous statuts</option>
            <option value="OUVERT">Ouvert</option>
            <option value="EN_COURS">En cours</option>
            <option value="TERMINE">Terminé</option>
          </select>
          <button class="btn btn-primary" id="btnRepairsFilter">Filtrer</button>
          <button class="btn btn-ghost" id="btnRepairsClear">Effacer</button>
        </form>

        <div class="divider"></div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Date</th><th>Client</th><th>Véhicule</th><th>Statut</th><th>Total TTC</th><th></th></tr></thead>
            <tbody id="repairsTbody"></tbody>
          </table>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="viewSettings" class="card" style="display:none">
        <h2>Paramètres</h2>
        <p class="muted">TPS/TVQ sont enregistrées dans le cloud (pour ton compte).</p>
        <div class="divider"></div>

        <form class="form" onsubmit="return false;">
          <label>TPS (%)</label>
          <input id="setTps" inputmode="decimal" placeholder="5" />
          <label>TVQ (%)</label>
          <input id="setTvq" inputmode="decimal" placeholder="9.975" />
          <div class="row">
            <button class="btn btn-primary" id="btnSaveSettings">Enregistrer</button>
          </div>
        </form>

        <div class="divider"></div>
        <h3>Sauvegarde</h3>
        <div class="row">
          <button class="btn btn-ghost" id="btnExport">Exporter (JSON)</button>
          <label class="btn btn-ghost" for="importFile" style="cursor:pointer">Importer (JSON)</label>
          <input id="importFile" type="file" accept="application/json" style="display:none" />
        </div>

        <div class="divider"></div>
        <h3>Maintenance</h3>
        <div class="row">
          <button class="btn btn-danger" id="btnResetCloud">Tout supprimer (cloud)</button>
        </div>
      </section>
    </section>
  </main>

  <footer class="footer no-print">
    <small>© <span id="year"></span> Garage Pro One — <span class="muted">Synchro Firebase</span></small>
  </footer>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal">
      <div class="card">
        <div class="row-between">
          <h2 id="modalTitle" style="margin:0">Modal</h2>
          <button class="btn btn-ghost btn-small" id="btnModalClose">Fermer</button>
        </div>
        <div class="divider"></div>
        <div id="modalBody"></div>
      </div>
    </div>
  </div>

  <script src="./assets/firebase-config.js"></script>
  <script type="module" src="./assets/app.js"></script>
</body>
</html>
